<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:p="http://primefaces.org/ui" xmlns:b="http://bootsfaces.net/ui"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:t="http://tulok.vzma.hu/tags">
<h:head>
	<h:outputStylesheet name="css/styles.css" />
</h:head>
<h:body>
	<ui:composition template="/xhtml/patrol/patrolFrame.xhtml">
		<ui:define name="innerContent">

			<b:form>
				<t:pageHeader title="Őrsi adatok" saveBean="#{patrolInfo}"
					saveMethod="saveEdit" undoBean="#{patrolController}"
					undoMethod="undoEdit" />
				<t:table>
					<t:rowWithLabel label="Őrs neve">
						<t:textField value="#{patrolController.patrol.name}" />
					</t:rowWithLabel>
					<t:rowWithLabel label="Alakulás ideje">
						<t:datepicker value="#{patrolController.patrol.birthdate}" />
					</t:rowWithLabel>
					<t:rowWithLabel label="Nem">
						<t:dropdown list="#{enums.genders}"
							value="#{patrolController.patrol.gender}" />
					</t:rowWithLabel>
				</t:table>


				<h:outputText value="Őrsvezetők:" styleClass="subTitle" />
				<t:table>
					<ui:repeat var="leader"
						value="#{utils.orderLeaderSet(patrolController.patrol.leaders)}"
						varStatus="var">
						<t:row>
							<t:entityLink entity="#{leader}" mode="leader" edit="false" />
						</t:row>
					</ui:repeat>
				</t:table>

				<b:panelGrid colSpans="12">

					<b:row styleClass="pulledRow">
						<h:outputText value="Őrstagok:" styleClass="subTitle" />
						<b:button value="Új őrstag" iconAwesome="plus" size="md"
							rendered="#{userController.edit}"
							onclick="$('.scout_modal').modal()" />
					</b:row>
					<t:dataTable value="#{patrolController.patrol.scouts}"
						order="status"
						rendered="#{not empty patrolController.patrol.scouts}" nums="true"
						noHead="true">
						<b:dataTableColumn>
							<b:row styleClass="pulledRow">
								<t:entityLink entity="#{item}" />
								<b:commandButton iconAwesome="trash" value="Töröl" size="xs"
									action="#{patrolInfo.deleteScout(item)}"
									rendered="#{userController.edit}" style="margin-left:10px;" />
							</b:row>
						</b:dataTableColumn>
					</t:dataTable>
					<h:outputText
						value="A szerkesztés gombra kattintva tudsz új őrstagot hozzáadni"
						rendered="#{empty patrolController.patrol.scouts}" />
				</b:panelGrid>

				<b:modal
					title="Új cserkész a(z) #{patrolController.patrol.getName()} őrsbe"
					rendered="#{userController.edit}" styleClass="scout_modal">
					<b:tabView pills="true">
						<b:tab title="Új cserkész létrehozása">
							<br />
							<b:panelGrid colSpans="4,8">
								<h:outputLabel value="Vezetéknév:" />
								<b:inputText value="#{patrolInfo.newScout.person.lastname}" />
								<h:outputLabel value="Keresztnév:" />
								<b:inputText value="#{patrolInfo.newScout.person.firstname}" />
								<h:outputLabel value="Nem:" />
								<b:selectOneMenu value="#{patrolInfo.newScout.person.gender}">
									<f:selectItems value="#{enums.genders}" var="gender"
										itemValue="#{gender}" itemLabel="#{gender.label}" />
								</b:selectOneMenu>
								<h:outputLabel value="Születési dátum:" />
								<b:datepicker value="#{patrolInfo.newScout.person.birthdate}"
									mode="popup-icon" changeMonth="true" changeYear="true" />
							</b:panelGrid>
							<h:outputText
								value="Minden más adatot a személyes oldalon tudsz majd beállítani." />
							<t:modalFooter mode="create"
								action="#{patrolInfo.saveNewScout()}" />
						</b:tab>
						<b:tab title="Meglévő cserkészek közül választás">
							<br />
							<b:panelGrid colSpans="4,8">
								<h:outputLabel value="Válassz a listából:" />
								<b:selectOneMenu value="#{patrolInfo.selectedScout}">
									<f:selectItems value="#{patrolInfo.allScouts}" var="scout"
										itemValue="#{scout}" itemLabel="#{scout.person.getFullName()}" />
								</b:selectOneMenu>
							</b:panelGrid>
							<t:modalFooter mode="select"
								action="#{patrolInfo.saveSelectedScout(patrolInfo.selectedScout)}" />
						</b:tab>
					</b:tabView>
				</b:modal>

			</b:form>

		</ui:define>
	</ui:composition>
</h:body>
</html>