<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:p="http://primefaces.org/ui" xmlns:b="http://bootsfaces.net/ui"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:t="http://tulok.vzma.hu/tags">
<h:head>
	<h:outputStylesheet name="css/styles.css" />
</h:head>
<h:body>
	<ui:composition template="/xhtml/team/teamFrame.xhtml">
		<ui:define name="innerContent">

			<b:form>
				<t:pageHeader title="Őrsök" saveBean="#{teamGroup}"
					saveMethod="saveEdit" undoBean="#{userController}"
					undoMethod="changeEdit">
					<b:commandButton value="Új őrs" iconAwesome="plus" ajax="true"
						update="@(.new_patrol_modal)"
						onclick="ajax:teamGroup.setForNewPatrolModal()"
						oncomplete="$('.new_patrol_modal').modal();return false;"
						size="md" style="margin: 0px 5px 0px 0px"
						rendered="#{userController.edit}" />
				</t:pageHeader>
				<b:dataTable value="#{teamGroup.patrols}" var="patrol" info="false"
					paginated="false" searching="false" scrollHorizontally="true">
					<b:dataTableColumn label="Név">
						<b:link value="#{patrol.name}" href="#{patrol.getPatrolUrl()}"
							rendered="#{not userController.edit}" />
						<b:inputText value="#{patrol.name}"
							rendered="#{userController.edit}" />
					</b:dataTableColumn>
					<b:dataTableColumn label="Nem">
						<h:outputText value="#{patrol.gender.label}"
							rendered="#{not userController.edit}" />
						<b:selectOneMenu value="#{patrol.gender}"
							rendered="#{userController.edit}">
							<f:selectItems value="#{enums.genders}" var="gender"
								itemValue="#{gender}" itemLabel="#{gender.label}" />
						</b:selectOneMenu>
					</b:dataTableColumn>
					<b:dataTableColumn label="Vezetők">
						<div>
							<b:commandButton iconAwesome="pencil" ajax="true"
								update="@(.set_leader_modal)"
								onclick="ajax:teamGroup.setForSetLeaderModal(patrol)"
								oncomplete="$('.set_leader_modal').modal();return false;"
								size="xs" style="margin: 0px 5px 0px 0px"
								rendered="#{userController.edit}" />
							<ui:repeat var="leader"
								value="#{userController.orderLeaderSet(patrol.leaders)}" varStatus="var">
								<b:link value="#{leader.scout.person.getFullName()}"
									href="#{leader.scout.getScoutUrl()}" />
								<h:outputText value=", " rendered="#{not var.last}"></h:outputText>
							</ui:repeat>
						</div>
					</b:dataTableColumn>
					<b:dataTableColumn label="Létszám">
						<h:outputText value="#{patrol.scouts.size()}" />
					</b:dataTableColumn>
					<b:dataTableColumn label="Alakulás ideje">
						<h:outputText value="#{patrol.getSimpleBirthdate()}"
							rendered="#{not userController.edit}" />
						<b:datepicker value="#{patrol.birthdate}"
							rendered="#{userController.edit}" mode="popup" changeMonth="true"
							changeYear="true" />
					</b:dataTableColumn>
					<b:dataTableColumn label="" rendered="#{userController.edit}">
						<div>
							<b:commandButton iconAwesome="trash" ajax="true"
								update="@(.delete_patrol_modal)"
								onclick="ajax:teamGroup.setForPatrolDeleteModal(patrol)"
								oncomplete="$('.delete_patrol_modal').modal();return false;"
								rendered="#{userController.edit}" />
						</div>
					</b:dataTableColumn>
				</b:dataTable>

				<b:modal title="Új őrs létrehozása" styleClass="new_patrol_modal"
					rendered="#{userController.edit}">
					<b:panelGrid colSpans="4,8">
						<h:outputLabel value="Őrs neve:" />
						<b:inputText value="#{teamGroup.newPatrol.name}" />
						<h:outputLabel value="Nem:" />
						<b:selectOneMenu value="#{teamGroup.newPatrol.gender}">
							<f:selectItems value="#{enums.genders}" var="gender"
								itemValue="#{gender}" itemLabel="#{gender.label}" />
						</b:selectOneMenu>
						<h:outputLabel value="Születésnap:" />
						<b:datepicker value="#{teamGroup.newPatrol.birthdate}"
							mode="popup-icon" changeMonth="true" changeYear="true" />
					</b:panelGrid>
					<b:panelGrid colSpans="12">
						<hr style="margin: 10px;" />
						<b:row>
							<div align="right" style="padding-right: 10px;">
								<b:button value="Vissza" iconAwesome="arrow-left"
									dismiss="modal" style="margin: 0px 5px;" />
								<b:commandButton value="Létrehoz" iconAwesome="save"
									action="#{teamGroup.savePatrol(teamGroup.newPatrol)}" />
							</div>
						</b:row>
					</b:panelGrid>
				</b:modal>

				<b:modal title="#{teamGroup.editedPatrol.name} őrs törlése"
					styleClass="delete_patrol_modal" rendered="#{userController.edit}">
					<b:panelGrid colSpans="12">
						<h:outputLabel
							value="Biztosan szeretnéd törölni a #{teamGroup.editedPatrol.name} őrsöt?" />
						<hr style="margin: 10px;" />
						<b:row>
							<div align="right" style="padding-right: 10px;">
								<b:button value="Vissza" iconAwesome="arrow-left"
									dismiss="modal" style="margin: 0px 5px;" />
								<b:commandButton value="Törlés" iconAwesome="trash"
									action="#{teamGroup.deletePatrol(teamGroup.editedPatrol)}" />
							</div>
						</b:row>
					</b:panelGrid>
				</b:modal>

				<b:modal
					title="#{teamGroup.editedPatrol.name} őrs vezetőinek szerkesztése"
					styleClass="set_leader_modal" rendered="#{userController.edit}">
					<b:tabView pills="true" activeIndex="0">
						<b:tab title="Új vezető">
							<br />
							<b:panelGrid colSpans="12"
								rendered="#{not empty teamGroup.choosableLeaders}">
								<h:outputLabel
									value="Válassz a listából egy vezetőt, akit hozzá szeretnél adni:" />
								<b:selectOneMenu value="#{teamGroup.leaderToAdd}">
									<f:selectItems value="#{teamGroup.choosableLeaders}"
										var="leader" itemValue="#{leader}"
										itemLabel="#{leader.scout.person.getFullName()}" />
								</b:selectOneMenu>
								<hr style="margin: 10px;" />
								<b:row>
									<div align="right" style="padding-right: 10px;">
										<b:button value="Vissza" iconAwesome="arrow-left"
											dismiss="modal" style="margin: 0px 5px;" />
										<b:commandButton value="Hozzáad" iconAwesome="save"
											action="#{teamGroup.addLeader(teamGroup.editedPatrol, teamGroup.leaderToAdd)}" />
									</div>
								</b:row>
							</b:panelGrid>
							<b:panelGrid colSpans="12"
								rendered="#{empty teamGroup.choosableLeaders}">
								<h:outputText value="Nincs olyan vezető, akit hozzáadhatnál." />
								<hr style="margin: 10px;" />
								<b:row>
									<div align="right" style="padding-right: 10px;">
										<b:button value="Vissza" iconAwesome="arrow-left"
											dismiss="modal" />
									</div>
								</b:row>
							</b:panelGrid>
						</b:tab>
						<b:tab title="Vezető törlése"
							rendered="#{not empty teamGroup.editedPatrol.leaders}">
							<br />
							<b:panelGrid colSpans="12">
								<h:outputLabel
									value="Válassz a listából egy vezetőt, akit törölni szeretnél:" />
								<b:selectOneMenu value="#{teamGroup.leaderToDelete}">
									<f:selectItems
										value="#{userController.orderLeaderSet(teamGroup.editedPatrol.leaders)}"
										var="leader" itemValue="#{leader}"
										itemLabel="#{leader.scout.person.getFullName()}" />
								</b:selectOneMenu>
								<hr style="margin: 10px;" />
								<b:row>
									<div align="right" style="padding-right: 10px;">
										<b:button value="Vissza" iconAwesome="arrow-left"
											dismiss="modal" style="margin: 0px 5px;" />
										<b:commandButton value="Töröl" iconAwesome="trash"
											action="#{teamGroup.deleteLeader(teamGroup.editedPatrol, teamGroup.leaderToDelete)}" />
									</div>
								</b:row>
							</b:panelGrid>
						</b:tab>
					</b:tabView>
				</b:modal>

			</b:form>

		</ui:define>
	</ui:composition>
</h:body>
</html>